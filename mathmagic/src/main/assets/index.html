<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="file:///android_asset/katex/katex.min.css"/>
    <style type="text/css">
        document {
            height: 100%;
            width: 100%;
        }

        body {
            margin: 0;
            padding: 0;
            -webkit-touch-callout: none !important;
            -webkit-user-select: none !important;
            user-select: none !important;
            height: 100%;
            width: 100%;
        }

        #math {
            min-height: 2em;
            line-height: 1.2em;
        }

        .display {
            text-align: center;
        }

        /* TODO fix padding */
    </style>
    <script defer src="file:///android_asset/katex/katex.min.js"></script>
    <script defer src="file:///android_asset/katex/contrib/mhchem.min.js"></script>
    <!-- TODO use copy-tex and a11y? -->
</head>
<body>
<main id="math"></main>
<script>
	//get options from URL parameters
	const urlParams = new URLSearchParams(window.location.search);
	const options = JSON.parse(decodeURIComponent(urlParams.get("options")));
	const tex = urlParams.has("tex") ? decodeURIComponent(urlParams.get("tex")) : null;

	//define body/math elements
	const body = document.querySelector("body");
	const math = document.querySelector("#math");

	/**
	 * helper function that decodes html string using textarea hack
	 * @param html string that should be decoded
	 */
	function _decodeHtml(html) {
		let text = document.createElement("textarea");
		text.innerHTML = html;
		return text.value;
	}

	/**
	 * initialize styles based on options
	 */
	function init() {
		if (options) {
			if (options.displayMode) math.classList.add("display");
			if (options.color) body.style.color = options.color;
			if (options.background) body.style.background = options.background;
		}
	}

	/**
	 * render passed TeX using KaTeX
	 * @param tex to be rendered
	 * @param options JSON object
	 */
	function update(tex) {
		katex.render(String.raw`${_decodeHtml(tex)}`, math, options);
	}

	//initialize with options
	init();

	//update tex when window is loaded
	window.addEventListener("load", function () {
		if (tex) update(tex);
	});
</script>
</body>
</html>